"use strict";(self.webpackChunksakai=self.webpackChunksakai||[]).push([[5117],{5117:(R,P,i)=>{i.d(P,{L:()=>W});var o=i(9197),_=i(5861),v=i(805),w=i(3003),h=i(574),b=i(6166),Z=i(4159),C=i.n(Z),t=i(4650),T=i(7747),a=i(5384),d=i(6895),s=i(585),x=i(5593),M=i(4006),U=i(2453),L=i(6768),H=i(1383);function k(r,O){if(1&r){const e=t.EpF();t.TgZ(0,"div",4)(1,"label",5),t._uU(2,"Usuarios"),t.qZA(),t.TgZ(3,"app-drop-down",17),t.NdJ("ValueSelectedChange",function(n){t.CHM(e);const c=t.oxw();return t.KtG(c.filterUser(n))}),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("IsCreating",!1)("showFilter",!0)("DropDownDataSource",e.usersDropDown)}}function J(r,O){if(1&r){const e=t.EpF();t.TgZ(0,"div",4)(1,"label",5),t._uU(2,"Sucursales"),t.qZA(),t.TgZ(3,"app-drop-down",18),t.NdJ("ValueSelectedChange",function(n){t.CHM(e);const c=t.oxw();return t.KtG(c.filterWareHouse(n))}),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(3),t.Q6J("IsCreating",!1)("showFilter",!0)("DropDownDataSource",e.wareHouseDropDown)}}function B(r,O){if(1&r&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"date"),t.ALo(3,"date"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE(" Reporte del ",t.lcZ(2,2,e.StartDate)," al ",t.lcZ(3,4,e.FinalDate)," ")}}function G(r,O){if(1&r&&(t.TgZ(0,"tr",19)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA()()),2&r){const e=O.$implicit;t.xp6(2),t.Oqu(e.createdBy),t.xp6(2),t.Oqu(e.sarNumber),t.xp6(2),t.Oqu(e.costumerName),t.xp6(2),t.Oqu(e.date),t.xp6(2),t.hij("",e.payPercentaje,"%"),t.xp6(2),t.Oqu(e.discount),t.xp6(2),t.Oqu(e.payCredit),t.xp6(2),t.Oqu(e.payOthers),t.xp6(2),t.Oqu(e.payCash),t.xp6(2),t.Oqu(e.total)}}function Q(r,O){if(1&r&&(t.TgZ(0,"tr",19)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA()()),2&r){const e=O.$implicit;t.xp6(2),t.Oqu(e.payName),t.xp6(2),t.Oqu(e.payType),t.xp6(2),t.Oqu(e.total)}}function Y(r,O){if(1&r){const e=t.EpF();t.TgZ(0,"div",20)(1,"button",21),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.printReport())}),t.qZA(),t.TgZ(2,"button",22),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.exportToExcel())}),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(2),t.Q6J("disabled",!e.InvoiceList||0===e.InvoiceList.length)}}let z=(()=>{class r{constructor(e,l,n,c){this.router=e,this.productService=l,this.messageService=n,this.eventService=c,this.loading=!1,this.InvoiceList=[],this.payReport=[],this.redirect=!1,this.AccessName="/pages/freportes"}ngOnInit(){const l=this.eventService.getPermisionsException().split(",").map(n=>n.trim());this.redirect=l.includes(this.AccessName),this.redirect&&this.router.navigateByUrl("/pages/unautorized"),this.userSelected="",this.wareHouseSelectd="",this.GetUsersByRole(),this.GetWareHouseByRole()}load(){this.loading=!0;var e=new w.c;e.initialDate=this.StartDate,e.finalDate=this.FinalDate,this.getInvoiceReport(e)}getInvoiceReport(e){const l=this.eventService.getToken();e.userFilter=null==this.userSelected||"0"==this.userSelected?"ALL":this.userSelected,e.warehouseFilter=null==this.wareHouseSelectd||"0"==this.wareHouseSelectd?"ALL":this.wareHouseSelectd,this.productService.GetInvoiceReport(e,l).subscribe(n=>{if(console.log(n),n.data){this.InvoiceList=n.data.invoices,this.payReport=n.data.pays;var c=0,u=0,f=0,m=0,p=0;this.InvoiceList?.forEach(g=>{c+=g.payOthers,u+=g.payCash,f+=g.payCredit,m+=g.total,p+=g.discount}),this.totalOthers=c,this.totalCash=u,this.totalCredit=f,this.totalInvoice=m,this.totalDiscount=p}else this.messageService.add({severity:"error",summary:"Error",detail:n.message,life:3e3});this.loading=!1},n=>{this.messageService.add({severity:"error",summary:"Error",detail:n.message,life:3e3}),this.loading=!1})}exportToExcel(){const l=[["Usuario","Fecha","N\xfamero SAR","Nombre del cliente","Descuentos","Pago en efectivo","Pago con cr\xe9dito","Otros pagos","Impuesto total","Total"]];this.InvoiceList.forEach(p=>{l.push([p.createdBy,p.date,p.sarNumber,p.costumerName,p.discount,p.payCash,p.payCredit,p.payOthers,p.totalTax,p.total])});const n=h.P6.aoa_to_sheet(l),c=h.P6.book_new();h.P6.book_append_sheet(c,n,"Detalle de Facturas");const f=[["Nombre de Pago","Tipo de Pago","Total"]];this.payReport.forEach(p=>{f.push([p.payName,p.payType,p.total])});const m=h.P6.aoa_to_sheet(f);h.P6.book_append_sheet(c,m,"Detalle de Pagos"),h.NC(c,"Facturas.xlsx")}filterUser(e){this.userSelected=""==e||null==e?"-1":e}GetUsersByRole(){this.isLoading=!0,this.productService.GetUsersByRoleValues(this.eventService.getToken()).subscribe(e=>{e.data&&(this.usersDropDown=e.data,console.log(this.usersDropDown))})}filterWareHouse(e){this.wareHouseSelectd=e,console.log(this.wareHouseSelectd)}GetWareHouseByRole(){this.productService.GetWareHouseByRoleValues(this.eventService.getToken()).subscribe(e=>{e.data&&(this.wareHouseDropDown=e.data),this.isLoading=!1})}printReport(){var e=this;return(0,_.Z)(function*(){e.messageService.add({severity:"info",summary:"Info",detail:"El reporte se esta generando, favor espere",life:3e3}),e.isLoading=!0;const l=document.getElementById("print-section"),n=new b.ZP("p","pt","a4"),c={background:"white",scale:3},u=n.internal.pageSize.getWidth(),f=n.internal.pageSize.getHeight(),m={top:15,bottom:15,left:15,right:15},p=u-m.left-m.right,g=f-m.top-m.bottom;function j(y,I,A){I.addImage(y,"PNG",m.left,A,p,0,void 0,"FAST")}try{const y=yield C()(l,c),A=(y.toDataURL("image/png"),y.width),D=A/p;let F=y.height/D,N=m.top,E=1;for(;F>0;){const q=Math.min(g,F),S=document.createElement("canvas"),X=S.getContext("2d");S.width=A,S.height=q*D,X.drawImage(y,0,(E-1)*g*D,A,q*D,0,0,A,q*D),j(S.toDataURL("image/png"),n,N),F-=g,N=m.top,F>0&&(n.addPage(),E++)}const K=n.output("blob"),$=URL.createObjectURL(K);e.isLoading=!1,window.open($,"_blank")}catch(y){console.error("Error generando PDF:",y),e.isLoading=!1}})()}static#t=this.\u0275fac=function(l){return new(l||r)(t.Y36(o.F0),t.Y36(T.M),t.Y36(v.ez),t.Y36(a.P))};static#e=this.\u0275cmp=t.Xpm({type:r,selectors:[["ng-component"]],features:[t._Bn([v.ez])],decls:78,vars:15,consts:[[1,"grid"],[1,"col-12"],[1,"card"],[2,"display","flex","flex-wrap","wrap","justify-content","space-between"],[2,"flex","1","margin","5px"],["for","age1"],["inputId","icon",3,"ngModel","showIcon","ngModelChange"],["style","width: 100%;","style","flex: 1; margin: 5px;",4,"ngIf"],["style","flex: 1; margin: 5px;",4,"ngIf"],["label","Buscar","icon","pi pi-search","iconPos","right",1,"space",2,"width","100%",3,"loading","onClick"],["id","print-section"],[4,"ngIf"],["style","font-size: small;",4,"ngFor","ngForOf"],[1,"totals-row"],[2,"margin-top","20px"],["styleClass","mb-4"],["pTemplate","left"],[3,"IsCreating","showFilter","DropDownDataSource","ValueSelectedChange"],[2,"width","100%",3,"IsCreating","showFilter","DropDownDataSource","ValueSelectedChange"],[2,"font-size","small"],[1,"my-2"],["printSectionId","PrintFull","pButton","","pRipple","","label","imprimir","icon","pi pi-print",1,"p-button-help",3,"click"],["pButton","","pRipple","","label","Exportar a Excel","icon","pi pi-cloud-download",1,"p-button-success","mr-2",2,"margin-left","10px",3,"disabled","click"]],template:function(l,n){if(1&l&&(t._UZ(0,"p-toast"),t.TgZ(1,"div")(2,"div",0)(3,"div",1)(4,"div",2)(5,"h4"),t._uU(6,"Reporte de Facturas"),t.qZA(),t.TgZ(7,"div",3)(8,"div",4)(9,"label",5),t._uU(10,"Inicial"),t.qZA(),t.TgZ(11,"p-calendar",6),t.NdJ("ngModelChange",function(u){return n.StartDate=u}),t.qZA()(),t.TgZ(12,"div",4)(13,"label",5),t._uU(14,"Final"),t.qZA(),t.TgZ(15,"p-calendar",6),t.NdJ("ngModelChange",function(u){return n.FinalDate=u}),t.qZA()(),t.YNc(16,k,4,3,"div",7),t.YNc(17,J,4,3,"div",8),t.TgZ(18,"div",4)(19,"p-button",9),t.NdJ("onClick",function(){return n.load()}),t.qZA()()(),t._UZ(20,"p")(21,"p"),t.TgZ(22,"div",10),t.YNc(23,B,4,6,"div",11),t.TgZ(24,"table")(25,"tr")(26,"th"),t._uU(27,"Usuario"),t.qZA(),t.TgZ(28,"th"),t._uU(29,"Fac. N."),t.qZA(),t.TgZ(30,"th"),t._uU(31,"Cliente"),t.qZA(),t.TgZ(32,"th"),t._uU(33,"Fecha"),t.qZA(),t.TgZ(34,"th"),t._uU(35,"% Pagado"),t.qZA(),t.TgZ(36,"th"),t._uU(37,"Descuento"),t.qZA(),t.TgZ(38,"th"),t._uU(39,"Credito"),t.qZA(),t.TgZ(40,"th"),t._uU(41,"Otros"),t.qZA(),t.TgZ(42,"th"),t._uU(43,"Efectivo"),t.qZA(),t.TgZ(44,"th"),t._uU(45,"Total"),t.qZA()(),t.YNc(46,G,21,10,"tr",12),t.TgZ(47,"tr",13),t._UZ(48,"td"),t.TgZ(49,"td"),t._uU(50,"Totales"),t.qZA(),t._UZ(51,"td")(52,"td")(53,"td"),t.TgZ(54,"td"),t._uU(55),t.qZA(),t.TgZ(56,"td"),t._uU(57),t.qZA(),t.TgZ(58,"td"),t._uU(59),t.qZA(),t.TgZ(60,"td"),t._uU(61),t.qZA(),t.TgZ(62,"td"),t._uU(63),t.qZA()()(),t.TgZ(64,"h5"),t._uU(65,"Detalle de Tipos de Pago sin contar cr\xe9ditos"),t.qZA(),t.TgZ(66,"table")(67,"tr")(68,"th"),t._uU(69,"Nombre"),t.qZA(),t.TgZ(70,"th"),t._uU(71,"Tipo"),t.qZA(),t.TgZ(72,"th"),t._uU(73,"Total"),t.qZA()(),t.YNc(74,Q,7,3,"tr",12),t.qZA()()()()()(),t.TgZ(75,"div",14)(76,"p-toolbar",15),t.YNc(77,Y,3,1,"ng-template",16),t.qZA()()),2&l){let c,u,f;t.xp6(11),t.Q6J("ngModel",n.StartDate)("showIcon",!0),t.xp6(4),t.Q6J("ngModel",n.FinalDate)("showIcon",!0),t.xp6(1),t.Q6J("ngIf",!n.isLoading&&(null!==(c=null==n.usersDropDown?null:n.usersDropDown.length)&&void 0!==c?c:0)>0),t.xp6(1),t.Q6J("ngIf",!n.isLoading&&(null!==(u=null==n.wareHouseDropDown?null:n.wareHouseDropDown.length)&&void 0!==u?u:0)>0),t.xp6(2),t.Q6J("loading",n.loading),t.xp6(4),t.Q6J("ngIf",(null!==(f=null==n.InvoiceList?null:n.InvoiceList.length)&&void 0!==f?f:0)>0),t.xp6(23),t.Q6J("ngForOf",n.InvoiceList),t.xp6(9),t.Oqu(n.totalDiscount),t.xp6(2),t.Oqu(n.totalCredit),t.xp6(2),t.Oqu(n.totalOthers),t.xp6(2),t.Oqu(n.totalCash),t.xp6(2),t.Oqu(n.totalInvoice),t.xp6(11),t.Q6J("ngForOf",n.payReport)}},dependencies:[d.sg,d.O5,s.f,x.Hq,x.zx,v.jx,M.JJ,M.On,U.FN,L.t,H.o,d.uU],styles:['[_ngcontent-%COMP%]:root {\n    --primary-color: #023b78;\n    --secondary-color: #1565bb;\n    --background-color: #f0f8ff;\n    --text-color: #333;\n    --border-color: #ccc;\n    --hover-color: #e9ecef;\n}\n\nbody[_ngcontent-%COMP%] {\n    font-family: Arial, sans-serif;\n    background-color: var(--background-color);\n    color: var(--text-color);\n    line-height: 1.6;\n    margin: 0;\n    padding: 20px;\n}\n\n#print-section[_ngcontent-%COMP%] {\n    background-color: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n    padding: 20px;\n}\n\n.card[_ngcontent-%COMP%] {\n    margin-bottom: 20px;\n}\n\nh4[_ngcontent-%COMP%] {\n    color: var(--primary-color);\n    margin-top: 0;\n    margin-bottom: 20px;\n}\n\n.grid[_ngcontent-%COMP%] {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 15px;\n    margin-bottom: 20px;\n}\n\n.col-12[_ngcontent-%COMP%] {\n    width: 100%;\n}\n\nlabel[_ngcontent-%COMP%] {\n    display: block;\n    margin-bottom: 5px;\n    color: var(--secondary-color);\n    font-weight: bold;\n}\n\np-calendar[_ngcontent-%COMP%], app-drop-down[_ngcontent-%COMP%] {\n    width: 100%;\n}\n\n.space[_ngcontent-%COMP%] {\n    margin-top: 10px;\n}\n\np-button[_ngcontent-%COMP%] {\n    width: 100%;\n}\n\np-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\n    background-color: var(--secondary-color);\n    border: none;\n    color: white;\n    padding: 10px;\n    border-radius: 4px;\n    cursor: pointer;\n    transition: background-color 0.3s;\n}\n\np-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover {\n    background-color: var(--primary-color);\n}\n\ntable[_ngcontent-%COMP%] {\n    width: 100%;\n    border-collapse: collapse;\n    margin-top: 20px;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n}\n\nth[_ngcontent-%COMP%], td[_ngcontent-%COMP%] {\n    border: 1px solid var(--border-color);\n    padding: 12px;\n    text-align: left;\n}\n\nth[_ngcontent-%COMP%] {\n    background-color: var(--primary-color);\n    color: white;\n    font-weight: bold;\n}\n\n\ntr[_ngcontent-%COMP%]:nth-child(even) {\n    background-color: var(--background-color);\n}\n\n\ntr[_ngcontent-%COMP%]:hover {\n    background-color: var(--hover-color) !important;\n    transition: background-color 0.3s ease;\n}\n\n\n.totals-row[_ngcontent-%COMP%] {\n    font-weight: bold;\n    background-color: var(--background-color);\n}\n\n#PrintFull[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%] {\n    color: var(--secondary-color);\n    margin-top: 30px;\n    margin-bottom: 15px;\n}\n\n\ninput[_ngcontent-%COMP%], select[_ngcontent-%COMP%] {\n    width: 100%;\n    padding: 8px;\n    border: 1px solid var(--border-color);\n    border-radius: 4px;\n    box-sizing: border-box;\n}\n\ninput[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus {\n    outline: none;\n    border-color: var(--secondary-color);\n    box-shadow: 0 0 0 2px rgba(21, 101, 187, 0.1);\n}\n\n\ndiv[style*="display: flex"][_ngcontent-%COMP%] {\n    gap: 15px;\n}\n\ndiv[style*="display: flex"][_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n    flex: 1;\n    min-width: 200px;\n}\n\n@media (max-width: 768px) {\n    div[style*="display: flex"][_ngcontent-%COMP%] {\n        flex-direction: column;\n    }\n    \n    div[style*="display: flex"][_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n        width: 100%;\n    }\n}']})}return r})(),W=(()=>{class r{static#t=this.\u0275fac=function(l){return new(l||r)};static#e=this.\u0275mod=t.oAB({type:r});static#n=this.\u0275inj=t.cJS({imports:[o.Bz.forChild([{path:"",component:z}]),o.Bz]})}return r})()},1383:(R,P,i)=>{i.d(P,{V:()=>T,o:()=>t});var o=i(4650),_=i(6895),v=i(805);function w(a,d){1&a&&o.GkF(0)}function h(a,d){if(1&a&&(o.TgZ(0,"div",3),o.YNc(1,w,1,0,"ng-container",4),o.qZA()),2&a){const s=o.oxw();o.xp6(1),o.Q6J("ngTemplateOutlet",s.leftTemplate)}}function b(a,d){1&a&&o.GkF(0)}function Z(a,d){if(1&a&&(o.TgZ(0,"div",5),o.YNc(1,b,1,0,"ng-container",4),o.qZA()),2&a){const s=o.oxw();o.xp6(1),o.Q6J("ngTemplateOutlet",s.rightTemplate)}}const C=["*"];let t=(()=>{class a{constructor(s){this.el=s}getBlockableElement(){return this.el.nativeElement.children[0]}ngAfterContentInit(){this.templates.forEach(s=>{switch(s.getType()){case"left":this.leftTemplate=s.template;break;case"right":this.rightTemplate=s.template}})}}return a.\u0275fac=function(s){return new(s||a)(o.Y36(o.SBq))},a.\u0275cmp=o.Xpm({type:a,selectors:[["p-toolbar"]],contentQueries:function(s,x,M){if(1&s&&o.Suo(M,v.jx,4),2&s){let U;o.iGM(U=o.CRH())&&(x.templates=U)}},hostAttrs:[1,"p-element"],inputs:{style:"style",styleClass:"styleClass"},ngContentSelectors:C,decls:4,vars:6,consts:[["role","toolbar",3,"ngClass","ngStyle"],["class","p-toolbar-group-left",4,"ngIf"],["class","p-toolbar-group-right",4,"ngIf"],[1,"p-toolbar-group-left"],[4,"ngTemplateOutlet"],[1,"p-toolbar-group-right"]],template:function(s,x){1&s&&(o.F$t(),o.TgZ(0,"div",0),o.Hsn(1),o.YNc(2,h,2,1,"div",1),o.YNc(3,Z,2,1,"div",2),o.qZA()),2&s&&(o.Tol(x.styleClass),o.Q6J("ngClass","p-toolbar p-component")("ngStyle",x.style),o.xp6(2),o.Q6J("ngIf",x.leftTemplate),o.xp6(1),o.Q6J("ngIf",x.rightTemplate))},dependencies:[_.mk,_.O5,_.tP,_.PC],styles:[".p-toolbar{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap}.p-toolbar-group-left,.p-toolbar-group-right{display:flex;align-items:center}\n"],encapsulation:2,changeDetection:0}),a})(),T=(()=>{class a{}return a.\u0275fac=function(s){return new(s||a)},a.\u0275mod=o.oAB({type:a}),a.\u0275inj=o.cJS({imports:[_.ez]}),a})()},5861:(R,P,i)=>{function o(v,w,h,b,Z,C,t){try{var T=v[C](t),a=T.value}catch(d){return void h(d)}T.done?w(a):Promise.resolve(a).then(b,Z)}function _(v){return function(){var w=this,h=arguments;return new Promise(function(b,Z){var C=v.apply(w,h);function t(a){o(C,b,Z,t,T,"next",a)}function T(a){o(C,b,Z,t,T,"throw",a)}t(void 0)})}}i.d(P,{Z:()=>_})}}]);